<div class="cd-cases-container">
  
  <!-- Pre-recorded video background (TEMPORARY REPLACEMENT) -->
  <div class="video-background-container" *ngIf="usePreRecordedVideo">
    <video 
      #backgroundVideo 
      class="background-video"
      [src]="'assets/3d/CD_Case/pregen_bg_small.webm'"
      autoplay 
      loop 
      muted
      playsinline
      preload="auto"
      webkit-playsinline
      x5-playsinline
      [attr.data-object-fit]="'cover'"
      (loadstart)="onVideoLoadStart()"
      (loadeddata)="onVideoLoadedData()"
      (canplay)="onVideoCanPlay()"
      (loadedmetadata)="onVideoMetadataLoaded()"
      (playing)="onVideoPlaying()"
      (pause)="onVideoPaused()"
      (error)="onVideoError($event)">
    </video>
    
    <!-- Fallback click-to-play overlay if autoplay fails -->
    <div 
      class="video-play-overlay" 
      *ngIf="videoPlaybackFailed"
      (click)="forceVideoPlay()">
      <div class="play-button">
        <div class="play-icon">â–¶</div>
        <div class="play-text">Click to start background video</div>
      </div>
    </div>
    <div class="video-overlay-text">
      <p>Using Pre-recorded Video Background</p>
      <small>Click "Enable 3D Rendering" to switch to live 3D</small>
    </div>
  </div>

  <!-- 3D CD Cases Canvas (TEMPORARILY DISABLED) -->
  <div class="original-3d-container" *ngIf="!usePreRecordedVideo">
    <canvas #canvas></canvas>
    <div #labelRenderer class="label-renderer"></div>
  </div>
  
  <!-- Loading indicator overlay -->
  <div class="loading-overlay" *ngIf="isLoading && !isRecordingMode" aria-live="polite">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading 3D CD Cases...</div>
  </div>
  
  <!-- Debug menu with OnPush change detection -->
  <app-debug-menu
    *ngIf="isDebugMode && !isRecordingMode"
    [sceneSettings]="sceneSettings"
    [caseSettings]="caseSettings"
    [cdCases]="cdCases"
    (updateCamera)="updateCamera()"
    (updateLighting)="updateLighting()"
    (updateRenderer)="updateRenderer()"
    (updateOrbitControls)="updateOrbitControls()"
    (updateGround)="updateGround()"
    (updateCaseTransform)="updateCaseTransform($event)"
    (resetToDefault)="resetToDefault()"
    (updateBackgroundEffects)="updateBackgroundEffects()">
  </app-debug-menu>
  
  <!-- Recording controls positioned directly below debug menu -->
  <div class="recording-controls-below-debug" *ngIf="forceShowRecordingControls || (isDebugMode && !isLoading)">
    <button 
      class="record-btn" 
      (click)="startRecording()"
      [disabled]="isRecordingMode || usePreRecordedVideo">
      {{ isRecordingMode ? 'Recording... (60s)' : 'Start 60s Recording' }}
    </button>
    
    <button 
      class="toggle-3d-btn" 
      (click)="toggle3DMode()"
      [disabled]="isRecordingMode">
      {{ usePreRecordedVideo ? 'Enable 3D Rendering' : 'Use Pre-recorded Video' }}
    </button>
  </div>
</div>

<!-- Case status indicators with title and artist information -->
<div class="case-indicators" 
     *ngIf="!isRecordingMode"
     [style.opacity]="isLoading ? '0' : '1'" 
     aria-live="polite">
  <h2 class="visually-hidden">CD Case Status</h2>
  <div *ngFor="let cdCase of cdCases; let i = index; trackBy: trackByCaseId" 
       class="case-indicator"
       [class.open]="cdCase.isOpen"
       [class.active]="cdCase.isActive"
       (click)="handleTrackSelection(i)"
       role="button"
       tabindex="0"
       [attr.aria-label]="'Select ' + cdCase.title + ' by ' + cdCase.artist">
    <strong>{{cdCase.title}}</strong> by {{cdCase.artist}}
    <span class="status">({{ cdCase.isOpen ? 'Open' : 'Closed' }})</span>
  </div>
</div> 