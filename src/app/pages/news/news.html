<!-- News Page -->
<div class="news-page anim-c">
  
  <!-- Site Header -->
  <app-site-header></app-site-header>
  
  <!-- TypeScript-based Square Animation (48 squares, space-like movement) -->
  <app-squares-animation [count]="48" [enabled]="true"></app-squares-animation>

  <!-- Main Content -->
  <main class="news-main">
    
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-content">
        <h1 class="title">PROJECT UPDATES</h1>
        <p class="subtitle">Latest News and Announcements</p>
        <p class="description">
          Stay updated with the latest developments, releases, and community highlights 
          from Prismatic Collections. Discover new features, technical improvements, and exciting announcements.
        </p>
      </div>
      <div class="hero-background">
        <div class="overlay"></div>
      </div>
    </section>

    <!-- Twitter Integration Section -->
    <section class="filters">
      <div class="filter-container twitter-integration">
        
        <!-- Header -->
        <div class="twitter-header">
          <div class="twitter-title">
            <mat-icon class="twitter-icon">alternate_email</mat-icon>
            <h3>Latest from Prismatic Collections</h3>
            <span class="twitter-handle">@{{ getTwitterUsername() }}</span>
          </div>
          <a
            [href]="getTwitterUrl()"
            target="_blank"
            rel="noopener noreferrer"
            class="follow-button"
            (click)="onFollowClick()">
            <mat-icon class="follow-icon">add</mat-icon>
            <span class="follow-text">Follow on X</span>
          </a>
        </div>
        
        <!-- Twitter Timeline Embed -->
        <div class="twitter-timeline-container">
          <div
            class="twitter-timeline-wrapper"
            [class.loading]="twitterLoading()"
            [class.error]="twitterError()">

            <!-- Loading State -->
            <div class="twitter-loading" *ngIf="twitterLoading()">
              <div class="loading-spinner"></div>
              <p class="loading-text">Loading latest tweets...</p>
            </div>

            <!-- Error State -->
            <div class="twitter-error" *ngIf="twitterError()">
              <mat-icon class="error-icon">warning</mat-icon>
              <p class="error-text">{{ twitterError() }}</p>
              <button class="retry-button" (click)="retryTwitterLoad()">
                <mat-icon class="retry-icon">refresh</mat-icon>
                Try Again
              </button>
            </div>

            <!-- Twitter Embed Container (Primary Method) -->
            <div
              id="twitter-embed-container"
              class="twitter-embed"
              *ngIf="embedLoaded() && !twitterLoading() && !twitterError()">
              <!-- Twitter widget will be injected here -->
            </div>

            <!-- Fallback Manual Tweets (When embed unavailable or API fails) -->
            <div class="manual-tweets" *ngIf="!twitterLoading() && twitterTweets().length > 0">
              <div class="tweet-card" *ngFor="let tweet of twitterTweets(); trackBy: trackByTweetId">
                <div class="tweet-header">
                  <div class="tweet-avatar">
                    <img src="/assets/images/artists/deltaether-avatar.svg" alt="Prismatic Collections" />
                  </div>
                  <div class="tweet-info">
                    <span class="tweet-name">{{ twitterUser()?.name || 'Prismatic Collections' }}</span>
                    <span class="tweet-handle">@{{ getTwitterUsername() }}</span>
                    <span class="tweet-date">{{ tweet.formatted_date || formatTweetDate(tweet.created_at) }}</span>
                  </div>
                </div>
                <div class="tweet-content">
                  <p [innerHTML]="formatTweetContent(tweet.text)"></p>
                  <div class="tweet-media" *ngIf="tweet.media && tweet.media.length > 0">
                    <img
                      [src]="tweet.media[0].url || tweet.media[0].preview_image_url"
                      [alt]="tweet.media[0].alt_text || 'Tweet media'"
                      loading="lazy" />
                  </div>
                  <!-- Tweet metrics if available -->
                  <div class="tweet-metrics" *ngIf="tweet.public_metrics">
                    <span class="metric">
                      <span class="metric-icon">üí¨</span>
                      {{ tweet.public_metrics.reply_count }}
                    </span>
                    <span class="metric">
                      <span class="metric-icon">üîÑ</span>
                      {{ tweet.public_metrics.retweet_count }}
                    </span>
                    <span class="metric">
                      <span class="metric-icon">‚ù§Ô∏è</span>
                      {{ tweet.public_metrics.like_count }}
                    </span>
                  </div>
                </div>
                <div class="tweet-actions">
                  <button class="tweet-action" (click)="openTweetUrl(tweet.id)">
                    <span class="action-icon">üîó</span>
                    <span class="action-text">View on X</span>
                  </button>
                  <button class="tweet-action" (click)="shareTweet(tweet)">
                    <span class="action-icon">‚ÜóÔ∏è</span>
                    <span class="action-text">Share</span>
                  </button>
                </div>
              </div>
            </div>

          </div>
        </div>
        
        <!-- Footer -->
        <div class="twitter-footer">
          <p class="twitter-footer-text">
            Stay updated with our latest announcements, releases, and behind-the-scenes content.
            <span *ngIf="getLastUpdateTime() !== 'Never'" class="last-update">
              Last updated: {{ getLastUpdateTime() }}
            </span>
          </p>
          <div class="twitter-footer-actions">
            <a
              [href]="getTwitterUrl()"
              target="_blank"
              rel="noopener noreferrer"
              class="footer-link primary">
              <mat-icon class="link-icon">star</mat-icon>
              View Full Timeline
            </a>
            <button
              class="footer-link secondary"
              (click)="refreshTwitterFeed()"
              [disabled]="twitterLoading()">
              <mat-icon class="link-icon">refresh</mat-icon>
              {{ twitterLoading() ? 'Loading...' : 'Refresh Feed' }}
            </button>
          </div>
        </div>
        
      </div>
    </section>

    <!-- Featured Articles Section -->
    <section class="featured-news" *ngIf="featuredArticles().length > 0">
      <h2 class="section-title">Featured Updates</h2>
      
      <div class="featured-grid">
        <article *ngFor="let article of featuredArticles(); trackBy: trackByArticleId" 
                 class="featured-article"
                 (click)="navigateToArticle(article.id)"
                 (mouseenter)="onArticleHover(article.id)">
          
          <!-- Featured Image -->
          <div class="article-image" *ngIf="article.featuredImage">
            <img [src]="article.featuredImage" 
                 [alt]="article.title" 
                 (error)="$event.target.style.display='none'">
            <div class="image-overlay"></div>
          </div>
          
          <!-- Article Content -->
          <div class="article-content">
            
            <!-- Article Meta -->
            <div class="article-meta">
              <span class="category-badge"
                    [style.background]="getCategoryGradient(article.category)">
                <mat-icon class="category-icon">{{ getCategoryIcon(article.category) }}</mat-icon>
                {{ getCategoryLabel(article.category) }}
              </span>
              <span class="publish-date">{{ formatDate(article.publishDate) }}</span>
              <span class="pinned-indicator" *ngIf="article.isPinned"><mat-icon>push_pin</mat-icon> Pinned</span>
            </div>
            
            <!-- Article Title and Subtitle -->
            <h3 class="article-title">{{ article.title }}</h3>
            <p class="article-subtitle">{{ article.subtitle }}</p>
            <p class="article-excerpt">{{ article.excerpt }}</p>
            
            <!-- Author Info -->
            <div class="author-info">
              <div class="author-avatar" *ngIf="article.author.avatar">
                <img [src]="article.author.avatar" [alt]="article.author.name">
              </div>
              <div class="author-details">
                <span class="author-name">{{ article.author.name }}</span>
                <span class="author-role">{{ article.author.role }}</span>
              </div>
            </div>
            
            <!-- Tags -->
            <div class="article-tags">
              <span *ngFor="let tag of article.tags" class="tag">#{{ tag }}</span>
            </div>
            
            <!-- Read More -->
            <div class="read-more">
              <span class="read-more-text">Read Full Article</span>
              <mat-icon class="read-more-arrow">arrow_forward</mat-icon>
            </div>
            
          </div>
          
        </article>
      </div>
    </section>

    <!-- Regular News Articles -->
    <section class="news-articles">
      <h2 class="section-title" *ngIf="featuredArticles().length > 0">Recent Updates</h2>
      <h2 class="section-title" *ngIf="featuredArticles().length === 0">All Updates</h2>
      
      <!-- No Results Message -->
      <div class="no-results" *ngIf="regularArticles().length === 0 && featuredArticles().length === 0">
        <div class="no-results-icon">üîç</div>
        <h3 class="no-results-title">No articles found</h3>
        <p class="no-results-text">
          No news articles are currently available.
        </p>
      </div>
      
      <!-- Articles Grid -->
      <div class="articles-grid" *ngIf="regularArticles().length > 0">
        <article *ngFor="let article of regularArticles(); trackBy: trackByArticleId" 
                 class="news-article"
                 (click)="navigateToArticle(article.id)"
                 (mouseenter)="onArticleHover(article.id)">
          
          <!-- Article Meta -->
          <div class="article-meta">
            <span class="category-badge small"
                  [style.background]="getCategoryGradient(article.category)">
              <span class="category-icon">{{ getCategoryIcon(article.category) }}</span>
              {{ getCategoryLabel(article.category) }}
            </span>
            <span class="publish-date">{{ formatDate(article.publishDate) }}</span>
          </div>
          
          <!-- Article Content -->
          <div class="article-content">
            <h3 class="article-title">{{ article.title }}</h3>
            <p class="article-subtitle" *ngIf="article.subtitle">{{ article.subtitle }}</p>
            <p class="article-excerpt">{{ article.excerpt }}</p>
            
            <!-- Author Info -->
            <div class="author-info compact">
              <span class="author-name">{{ article.author.name }}</span>
              <span class="author-separator">‚Ä¢</span>
              <span class="author-role">{{ article.author.role }}</span>
            </div>
            
            <!-- Tags -->
            <div class="article-tags">
              <span *ngFor="let tag of article.tags.slice(0, 3)" class="tag small">#{{ tag }}</span>
              <span *ngIf="article.tags.length > 3" class="tag-more">+{{ article.tags.length - 3 }} more</span>
            </div>
          </div>
          
          <!-- Read More Indicator -->
          <div class="read-indicator">
            <span class="read-text">Read More</span>
            <mat-icon class="read-arrow">arrow_forward</mat-icon>
          </div>
          
        </article>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="newsletter-cta">
      <div class="cta-content">
        <h2 class="cta-title">Stay Updated</h2>
        <p class="cta-text">
          Never miss an update! Follow our social channels or bookmark this page 
          to stay informed about the latest developments in Prismatic Collections.
        </p>
        <div class="cta-buttons">
          <button class="button primary" (click)="router.navigate(['/socials'])">
            <mat-icon class="button-icon">notifications</mat-icon>
            Follow Us
            <span class="button-description">Join our community channels</span>
          </button>
          <button class="button secondary" (click)="router.navigate(['/collections'])">
            <mat-icon class="button-icon">palette</mat-icon>
            Explore Collections
            <span class="button-description">Discover our interactive experiences</span>
          </button>
        </div>
      </div>
    </section>
    
  </main>
  
</div>
